import pandas as pd
import numpy as np

from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, classification_report, confusion_matrix

# CSV yolu
file_path = r"your_file"


df = pd.read_csv(file_path)

# Sütun adlarındaki boşlukları temizle
df.columns = df.columns.str.strip()

# Tarihi datetime'a çevir
df["Doğum Tarihi/Birth Date"] = pd.to_datetime(
    df["Doğum Tarihi/Birth Date"], dayfirst=True
)

# Burç fonksiyonu
def get_zodiac(day, month):
    if (month == 3 and day >= 21) or (month == 4 and day <= 19):
        return "Koç"
    elif (month == 4 and day >= 20) or (month == 5 and day <= 20):
        return "Boğa"
    elif (month == 5 and day >= 21) or (month == 6 and day <= 20):
        return "İkizler"
    elif (month == 6 and day >= 21) or (month == 7 and day <= 22):
        return "Yengeç"
    elif (month == 7 and day >= 23) or (month == 8 and day <= 22):
        return "Aslan"
    elif (month == 8 and day >= 23) or (month == 9 and day <= 22):
        return "Başak"
    elif (month == 9 and day >= 23) or (month == 10 and day <= 22):
        return "Terazi"
    elif (month == 10 and day >= 23) or (month == 11 and day <= 21):
        return "Akrep"
    elif (month == 11 and day >= 22) or (month == 12 and day <= 21):
        return "Yay"
    elif (month == 12 and day >= 22) or (month == 1 and day <= 19):
        return "Oğlak"
    elif (month == 1 and day >= 20) or (month == 2 and day <= 18):
        return "Kova"
    elif (month == 2 and day >= 19) or (month == 3 and day <= 20):
        return "Balık"

# Burç sütunu oluştur
df["burc"] = df["Doğum Tarihi/Birth Date"].apply(
    lambda x: get_zodiac(x.day, x.month)
)

print("Burç dağılımı:")
print(df["burc"].value_counts())
print("Dataset shape:", df.shape)

#FEATURE & LABEL
features = [
    "Sosyal ortamlarda bulunmayı severim",
    "Yeni insanlarla tanışmak beni heyecanlandırır",
    "Yalnız kalıp düşünmeyi severim",
    "Planlı ve düzenli olmayı tercih ederim",
    "Anlık kararlar almaktan hoşlanırım",
    "Duygularım kararlarımı etkiler",
    "Mantık benim için duygulardan daha önemlidir",
    "Risk almaktan çekinmem",
    "Detaylara dikkat ederim",
    "Büyük resmi görmek benim için daha önemlidir",
    "Liderlik rolü almaktan hoşlanırım",
    "Eleştirilere karşı hassasım",
    "Stresli durumlarda sakin kalabilirim",
    "Değişime kolay adapte olurum",
    "Kurallara uymak benim için önemlidir"
]

X = df[features]
y = df["burc"]

print("X shape:", X.shape)
print("y shape:", y.shape)


X_train, X_test, y_train, y_test = train_test_split(
    X, y, 
    test_size=0.3, 
    random_state=42, 
    stratify=y
)

model = RandomForestClassifier(
    n_estimators=200,
    random_state=42
)

model.fit(X_train, y_train)

y_pred = model.predict(X_test)

print("Accuracy:", accuracy_score(y_test, y_pred))
print("\nClassification Report:\n", classification_report(y_test, y_pred))
print("\nConfusion Matrix:\n", confusion_matrix(y_test, y_pred))

#FEATURE IMPORTANCE
importances = model.feature_importances_

feature_importance_df = pd.DataFrame({
    "Özellik": features,
    "Önem Skoru": importances
}).sort_values(by="Önem Skoru", ascending=False)

print("\nFeature Importance (Özellik Önem Sıralaması):")
print(feature_importance_df)


import matplotlib.pyplot as plt
from sklearn.metrics import ConfusionMatrixDisplay

#Confusion matrix hesapla
cm = confusion_matrix(y_test, y_pred)

# Plot
plt.figure(figsize=(10, 8))
disp = ConfusionMatrixDisplay(
    confusion_matrix=cm,
    display_labels=model.classes_
)
disp.plot(cmap="Blues", values_format="d")

plt.title("Confusion Matrix – Burç Tahmin Modeli", fontsize=14)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()


import matplotlib.pyplot as plt


plt.figure(figsize=(10, 6))

plt.barh(
    feature_importance_df["Özellik"],
    feature_importance_df["Önem Skoru"]
)

plt.xlabel("Önem Skoru")
plt.ylabel("Özellikler")
plt.title("Feature Importance – Burç Tahmin Modeli")

plt.gca().invert_yaxis()  # En önemli özellik en üstte olsun
plt.tight_layout()
plt.show()


